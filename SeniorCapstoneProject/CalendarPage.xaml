<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="SeniorCapstoneProject.CalendarPage"
             Title="Calendar"
             BackgroundColor="#F8F9FA">

    <Grid RowDefinitions="Auto,Auto,*,Auto">
        <!-- Header -->
        <Grid Grid.Row="0" Padding="24,24,24,16" BackgroundColor="White">
            <Button Text="←" 
                    FontSize="24" 
                    WidthRequest="40" 
                    HeightRequest="40" 
                    CornerRadius="20" 
                    BackgroundColor="Transparent" 
                    TextColor="#2E91FF" 
                    HorizontalOptions="Start" 
                    Clicked="OnBackButtonClicked"/>
            <Label Text="My Calendar" 
                   FontSize="28" 
                   FontAttributes="Bold" 
                   HorizontalOptions="Center" 
                   VerticalOptions="Center"
                   TextColor="#22223B"/>
            <Button Text="+" 
                    FontSize="32" 
                    WidthRequest="40" 
                    HeightRequest="40" 
                    CornerRadius="20" 
                    BackgroundColor="#2E91FF" 
                    TextColor="White" 
                    HorizontalOptions="End" 
                    Clicked="OnAddAppointmentClicked"/>
        </Grid>

        <!-- Month Overview Card -->
        <Border Grid.Row="1" Margin="24,16,24,0" Padding="20" StrokeThickness="0">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="20"/>
            </Border.StrokeShape>
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#667EEA" Offset="0.0" />
                    <GradientStop Color="#2E91FF" Offset="1.0" />
                </LinearGradientBrush>
            </Border.Background>
            <Grid ColumnDefinitions="Auto,*,Auto">
                <VerticalStackLayout Spacing="4">
                    <Label Text="" FontSize="48"/>
                </VerticalStackLayout>
                <VerticalStackLayout Grid.Column="1" Spacing="8" Padding="16,0,0,0">
                    <Label Text="{Binding CurrentMonth}" FontSize="20" FontAttributes="Bold" TextColor="White"/>
                    <Label Text="{Binding AppointmentCount, StringFormat='{0} appointments scheduled'}" FontSize="16" TextColor="White" Opacity="0.9"/>
                    <Label Text="{Binding NextAppointmentText}" FontSize="13" TextColor="White" Opacity="0.9"/>
                </VerticalStackLayout>
                <Label Grid.Column="2" 
                       Text="›" 
                       FontSize="40" 
                       TextColor="White" 
                       Opacity="0.5"
                       VerticalOptions="Center"/>
            </Grid>
        </Border>

        <ScrollView Grid.Row="2">
            <VerticalStackLayout Padding="24,16,24,24" Spacing="16">
                <!-- Upcoming Appointments -->
                <Label Text="Upcoming Appointments" FontSize="20" FontAttributes="Bold" TextColor="#22223B"/>

                <CollectionView ItemsSource="{Binding Appointments}">
                    <CollectionView.EmptyViewTemplate>
                        <DataTemplate>
                            <Border BackgroundColor="White" 
                                    Padding="40" 
                                    StrokeThickness="1" 
                                    Margin="0,8,0,0">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="16"/>
                                </Border.StrokeShape>
                                <Border.Stroke>
                                    <SolidColorBrush Color="#E0E0E0"/>
                                </Border.Stroke>
                                <VerticalStackLayout Spacing="12" HorizontalOptions="Center">
                                    <Label Text="📅" 
                                           FontSize="56" 
                                           HorizontalTextAlignment="Center"/>
                                    <Label Text="No appointments scheduled" 
                                           FontSize="18" 
                                           FontAttributes="Bold"
                                           TextColor="#22223B" 
                                           HorizontalTextAlignment="Center"/>
                                    <Label Text="Tap the + button to schedule your first appointment" 
                                           FontSize="14" 
                                           TextColor="#999" 
                                           HorizontalTextAlignment="Center"/>
                                </VerticalStackLayout>
                            </Border>
                        </DataTemplate>
                    </CollectionView.EmptyViewTemplate>
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Border BackgroundColor="White" 
                                    Padding="20" 
                                    StrokeThickness="1" 
                                    Margin="0,0,0,12">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="16"/>
                                </Border.StrokeShape>
                                <Border.Stroke>
                                    <SolidColorBrush Color="#E0E0E0"/>
                                </Border.Stroke>
                                <Grid ColumnDefinitions="Auto,*,Auto" RowSpacing="12">
                                    <!-- Date Badge -->
                                    <Border BackgroundColor="#2E91FF" 
                                            WidthRequest="70" 
                                            HeightRequest="70" 
                                            StrokeThickness="0" 
                                            VerticalOptions="Start">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="16"/>
                                        </Border.StrokeShape>
                                        <VerticalStackLayout Spacing="0" HorizontalOptions="Center" VerticalOptions="Center">
                                            <Label Text="{Binding Date, StringFormat='{0:dd}'}" 
                                                   FontSize="28" 
                                                   FontAttributes="Bold" 
                                                   TextColor="White"
                                                   HorizontalTextAlignment="Center"/>
                                            <Label Text="{Binding Date, StringFormat='{0:MMM}'}" 
                                                   FontSize="13" 
                                                   TextColor="White"
                                                   Opacity="0.9"
                                                   HorizontalTextAlignment="Center"/>
                                        </VerticalStackLayout>
                                    </Border>

                                    <!-- Appointment Details -->
                                    <VerticalStackLayout Grid.Column="1" 
                                                         Spacing="6" 
                                                         Padding="16,0,0,0"
                                                         VerticalOptions="Center">
                                        <Label Text="{Binding DoctorName}" 
                                               FontSize="18" 
                                               FontAttributes="Bold" 
                                               TextColor="#22223B"/>
                                        <HorizontalStackLayout Spacing="6">
                                            <Label Text="🕐" FontSize="14"/>
                                            <Label Text="{Binding TimeRange}" 
                                                   FontSize="14" 
                                                   TextColor="#2E91FF"
                                                   FontAttributes="Bold"/>
                                        </HorizontalStackLayout>
                                        <HorizontalStackLayout Spacing="6">
                                            <Label Text="📍" FontSize="14"/>
                                            <Label Text="{Binding Location}" 
                                                   FontSize="13" 
                                                   TextColor="#666"
                                                   LineBreakMode="TailTruncation"/>
                                        </HorizontalStackLayout>
                                    </VerticalStackLayout>

                                    <!-- Actions -->
                                    <VerticalStackLayout Grid.Column="2" 
                                                         Spacing="8"
                                                         VerticalOptions="Center">
                                        <Border BackgroundColor="#F0F0F0" 
                                                WidthRequest="44" 
                                                HeightRequest="44" 
                                                StrokeThickness="0">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="12"/>
                                            </Border.StrokeShape>
                                            <Label Text="✏️" 
                                                   FontSize="20" 
                                                   HorizontalOptions="Center" 
                                                   VerticalOptions="Center"/>
                                            <Border.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnEditAppointmentClicked" CommandParameter="{Binding .}"/>
                                            </Border.GestureRecognizers>
                                        </Border>
                                        <Border BackgroundColor="#FEE" 
                                                WidthRequest="44" 
                                                HeightRequest="44" 
                                                StrokeThickness="0">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="12"/>
                                            </Border.StrokeShape>
                                            <Label Text="🗑️" 
                                                   FontSize="20" 
                                                   HorizontalOptions="Center" 
                                                   VerticalOptions="Center"/>
                                            <Border.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnDeleteAppointmentClicked" CommandParameter="{Binding .}"/>
                                            </Border.GestureRecognizers>
                                        </Border>
                                    </VerticalStackLayout>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- Past Appointments Section (Optional) -->
                <Label Text="Past Appointments" 
                       FontSize="20" 
                       FontAttributes="Bold" 
                       TextColor="#22223B" 
                       Margin="0,24,0,0"
                       IsVisible="{Binding HasPastAppointments}"/>

                <CollectionView ItemsSource="{Binding PastAppointments}"
                                IsVisible="{Binding HasPastAppointments}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Border BackgroundColor="White" 
                                    Padding="16" 
                                    StrokeThickness="1" 
                                    Margin="0,0,0,12"
                                    Opacity="0.7">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="16"/>
                                </Border.StrokeShape>
                                <Border.Stroke>
                                    <SolidColorBrush Color="#E0E0E0"/>
                                </Border.Stroke>
                                <Grid ColumnDefinitions="Auto,*">
                                    <Border BackgroundColor="#E0E0E0" 
                                            WidthRequest="56" 
                                            HeightRequest="56" 
                                            StrokeThickness="0" 
                                            VerticalOptions="Start">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="12"/>
                                        </Border.StrokeShape>
                                        <VerticalStackLayout Spacing="0" HorizontalOptions="Center" VerticalOptions="Center">
                                            <Label Text="{Binding Date, StringFormat='{0:dd}'}" 
                                                   FontSize="22" 
                                                   FontAttributes="Bold" 
                                                   TextColor="#666"
                                                   HorizontalTextAlignment="Center"/>
                                            <Label Text="{Binding Date, StringFormat='{0:MMM}'}" 
                                                   FontSize="11" 
                                                   TextColor="#999"
                                                   HorizontalTextAlignment="Center"/>
                                        </VerticalStackLayout>
                                    </Border>

                                    <VerticalStackLayout Grid.Column="1" 
                                                         Spacing="4" 
                                                         Padding="12,0,0,0"
                                                         VerticalOptions="Center">
                                        <Label Text="{Binding DoctorName}" 
                                               FontSize="16" 
                                               FontAttributes="Bold" 
                                               TextColor="#666"/>
                                        <Label Text="{Binding TimeRange}" 
                                               FontSize="13" 
                                               TextColor="#999"/>
                                        <Label Text="✓ Completed" 
                                               FontSize="12" 
                                               TextColor="#4CAF50"
                                               FontAttributes="Bold"/>
                                    </VerticalStackLayout>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- Quick Stats -->
                <Label Text="This Month" FontSize="20" FontAttributes="Bold" TextColor="#22223B" Margin="0,16,0,0"/>

                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                    <Border BackgroundColor="White" Padding="20" StrokeThickness="1">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="16"/>
                        </Border.StrokeShape>
                        <Border.Stroke>
                            <SolidColorBrush Color="#E0E0E0"/>
                        </Border.Stroke>
                        <VerticalStackLayout Spacing="8" HorizontalOptions="Center">
                            <Label Text="{Binding TotalAppointments}" FontSize="28" FontAttributes="Bold" TextColor="#2E91FF"/>
                            <Label Text="Total Visits" FontSize="12" TextColor="#666" HorizontalTextAlignment="Center"/>
                        </VerticalStackLayout>
                    </Border>

                    <Border Grid.Column="1" BackgroundColor="White" Padding="20" StrokeThickness="1">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="16"/>
                        </Border.StrokeShape>
                        <Border.Stroke>
                            <SolidColorBrush Color="#E0E0E0"/>
                        </Border.Stroke>
                        <VerticalStackLayout Spacing="8" HorizontalOptions="Center">
                            <Label Text="{Binding HoursSpent}" FontSize="28" FontAttributes="Bold" TextColor="#FF9800"/>
                            <Label Text="Hours Spent" FontSize="12" TextColor="#666" HorizontalTextAlignment="Center"/>
                        </VerticalStackLayout>
                    </Border>
                </Grid>

                <BoxView HeightRequest="20"/>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>